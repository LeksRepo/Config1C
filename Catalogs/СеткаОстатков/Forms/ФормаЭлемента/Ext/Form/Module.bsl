
&НаКлиенте
Процедура Заполнить(Команда)
	
	Объект.СеткаОстатков.Очистить();
	ЗаполнитьНаСервере();
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьНаСервере(Открытие = Ложь, НужноеЗначение = Ложь)
	
	ТабДок = Новый ТабличныйДокумент;
	ТабДок.Очистить();
	Макет = Справочники.СеткаОстатков.ПолучитьМакет("Макет");
	ОбластьЯчейка = Макет.ПолучитьОбласть("Ячейка");
	ОбластьЦифра = Макет.ПолучитьОбласть("Цифра");
	ШиринаТаблицы = 0;
	ВысотаТаблицы = ?(Объект.Шаг > 0, Объект.Шаг, 100);
		
	Пока ШиринаТаблицы <= Объект.МаксимальнаяШирина Цикл
		
		ОбластьЦифра.Параметры.Цифра = ШиринаТаблицы;
		ТабДок.Присоединить(ОбластьЦифра);
		ШиринаТаблицы = ШиринаТаблицы + ?(Объект.Шаг > 0, Объект.Шаг, 100);
		
	КонецЦикла;
		
	Пока ВысотаТаблицы <= Объект.МаксимальнаяВысота Цикл
		
		ШиринаТаблицы = ?(Объект.Шаг > 0, Объект.Шаг, 100);
		ОбластьЦифра.Параметры.Цифра = ВысотаТаблицы;
		ТабДок.Вывести(ОбластьЦифра);
		
		Пока ШиринаТаблицы <= Объект.МаксимальнаяШирина Цикл
			
			Структура = Новый Структура;
			Структура.Вставить("Высота", ВысотаТаблицы);
			Структура.Вставить("Ширина", ШиринаТаблицы);
			
			Если Открытие Тогда
				
				Отбор = Новый Структура;
				Отбор.Вставить("Высота", ВысотаТаблицы);
				Отбор.Вставить("Ширина", ШиринаТаблицы);
				Строка = Объект.СеткаОстатков.НайтиСтроки(Отбор);
				
				Если Строка.Количество() > 0 Тогда
					
					Структура.Вставить("Заполненность", Строка[0].Значение);
					
				КонецЕсли;
				
			Иначе
				
				Структура.Вставить("Заполненность", НужноеЗначение);
				
				НоваяСтрока = Объект.СеткаОстатков.Добавить();
				НоваяСтрока.Высота = ВысотаТаблицы;
				НоваяСтрока.Ширина = ШиринаТаблицы;
				НоваяСтрока.Значение = НужноеЗначение;
				
			КонецЕсли;
			
			ОбластьЯчейка.Параметры.Заполненность = Структура.Заполненность;
			ОбластьЯчейка.Параметры.Расшифровка = Структура;
			ТабДок.Присоединить(ОбластьЯчейка);
			ШиринаТаблицы = ШиринаТаблицы + ?(Объект.Шаг > 0, Объект.Шаг, 100);
			
		КонецЦикла;
		
		ВысотаТаблицы = ВысотаТаблицы + ?(Объект.Шаг > 0, Объект.Шаг, 100);
		
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура ТабДокВыбор(Элемент, Область, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	НовоеЗначение = НЕ Область.Расшифровка.Заполненность;
	Область.Расшифровка.Заполненность = НовоеЗначение;
	Отбор = Новый Структура;
	Отбор.Вставить("Высота", Область.Расшифровка.Высота);
	Отбор.Вставить("Ширина", Область.Расшифровка.Ширина);
	Строка = Объект.СеткаОстатков.НайтиСтроки(Отбор);
	Область.Текст = ?(Область.Текст = "Х", " ", "Х");
	
	Если Строка.Количество() > 0 Тогда
		
		Строка[0].Значение = НовоеЗначение;
		
	КонецЕсли;
	
	Модифицированность = Истина;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ПриОткрытииНаСервере();
КонецПроцедуры

&НаСервере
Процедура ПриОткрытииНаСервере()
	
	Если НЕ Объект.Ссылка = Справочники.СеткаОстатков.ПустаяСсылка() Тогда
		
		ЗаполнитьНаСервере(Истина);
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВыбратьВсе(Команда)
	
	Объект.СеткаОстатков.Очистить();
	Модифицированность = Истина;
	ЗаполнитьНаСервере(, Истина);
	
КонецПроцедуры

&НаКлиенте
Процедура Очистить(Команда)
	
	Объект.СеткаОстатков.Очистить();
	Модифицированность = Истина;
	ЗаполнитьНаСервере();
	
КонецПроцедуры
