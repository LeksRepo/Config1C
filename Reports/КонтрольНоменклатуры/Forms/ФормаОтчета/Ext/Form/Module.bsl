
&НаКлиенте
Процедура РезультатОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
	
	ПараметрыСтр = ПолучитьРасшифровкуНаСервере(Расшифровка);
	
	Если ЗначениеЗаполнено(ПараметрыСтр.Номенклатура) Тогда
		
		СтандартнаяОбработка = Ложь;
		
		ПараметрыРасшифровки = Новый Структура();
		ПараметрыРасшифровки.Вставить("Подразделение", ПараметрыСтр.Подразделение);
		ПараметрыРасшифровки.Вставить("Номенклатура", ПараметрыСтр.Номенклатура);
				
		ОткрытьФорму("Отчет.КонтрольНоменклатуры.Форма.ФормаРасшифровкиИсторияЦен", ПараметрыРасшифровки, ЭтаФорма);
	
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция ПолучитьРасшифровкуНаСервере(фнРасшифровка)
	
	ПараметрыСтр = Новый Структура();
	ПараметрыСтр.Вставить("Номенклатура", "");
	ПараметрыСтр.Вставить("Подразделение", "");
	
	Данные = ПолучитьИзВременногоХранилища(ДанныеРасшифровки);
	ЭлементыРасшифровки = Данные.Элементы.Получить(фнРасшифровка);
	Поля = ЭлементыРасшифровки.ПолучитьПоля();
	
	Если Поля.Количество() = 1 Тогда
		Поле = Поля[0].Поле;
	КонецЕсли;
	
	Если Поле = "Номенклатура"
	 ИЛИ Поле = "ПлановаяЗакупочная"
	 ИЛИ Поле = "Розничная" Тогда
		
		МассивРодители = ЭлементыРасшифровки.ПолучитьРодителей();
		Если МассивРодители.Количество() = 1 Тогда
			ПолеРодителя = Данные.Элементы.Получить(МассивРодители[0].Идентификатор).ПолучитьПоля();
			ПараметрыСтр.Номенклатура = ПолеРодителя[0].Значение;
		КонецЕсли;
		
		НастройкаПодразделение = Отчет.КомпоновщикНастроек.ПользовательскиеНастройки.Элементы[0];
		
		Если НастройкаПодразделение <> Неопределено Тогда
			ПараметрыСтр.Подразделение = НастройкаПодразделение.Значение;
		КонецЕсли;
		
	КонецЕсли;
	
	Возврат ПараметрыСтр;
	
КонецФункции
