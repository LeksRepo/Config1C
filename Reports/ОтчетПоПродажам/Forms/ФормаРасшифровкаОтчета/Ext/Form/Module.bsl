
&НаСервере
Функция СформироватьОтчет(Период, Показатель, СписокПодразделений, ОбщаяСуммаДокументов)
	
	ТабДок = Новый ТабличныйДокумент;
	
	Макет = Отчеты.ОтчетПоПродажам.ПолучитьМакет("МакетРасшифровкиРегистратор");
	ОбластьЗаголовок = Макет.ПолучитьОбласть("Заголовок");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
	ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
	ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
	ОбластьЗаголовок.Параметры.Период = ПредставлениеПериода(НачалоМесяца(Период),КонецМесяца(Период));
	ОбластьЗаголовок.Параметры.Показатель = Показатель;
	ОбластьЗаголовок.Параметры.СписокПодразделений = ПолучитьСписокСтрокой(СписокПодразделений);
	ТабДок.Вывести(ОбластьЗаголовок);
	ТабДок.Вывести(ОбластьШапка);
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("НачалоПериода", НачалоМесяца(Период));
	Запрос.УстановитьПараметр("КонецПериода", КонецМесяца(Период));
	Запрос.УстановитьПараметр("СписокПодразделений", СписокПодразделений);
	Запрос.УстановитьПараметр("Показатель", Показатель);
	Запрос.Текст =
	"ВЫБРАТЬ
	|	УправленческийДвиженияССубконто.Регистратор КАК Документ,
	|	УправленческийДвиженияССубконто.Подразделение КАК Подразделение,
	|	УправленческийДвиженияССубконто.Сумма КАК Сумма,
	|	УправленческийДвиженияССубконто.Регистратор.Комментарий КАК Комментарий,
	|	УправленческийДвиженияССубконто.Регистратор.Ссылка КАК Ссылка
	|ИЗ
	|	РегистрБухгалтерии.Управленческий.ДвиженияССубконто(
	|			&НачалоПериода,
	|			&КонецПериода,
	|			Подразделение В (&СписокПодразделений)
	|				И СубконтоДт1 = &Показатель,
	|			,
	|			) КАК УправленческийДвиженияССубконто
	|
	|УПОРЯДОЧИТЬ ПО
	|	УправленческийДвиженияССубконто.Регистратор.Дата";

	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	НомерСтроки = 1;
	
	Пока Выборка.Следующий() Цикл
		
		ОбластьСтрока.Параметры.Заполнить(Выборка);
		ОбластьСтрока.Параметры.НомерСтроки = НомерСтроки;
		ОбластьСтрока.Параметры.РасшифровкаДокумент = Выборка.Ссылка;
		ТабДок.Вывести(ОбластьСтрока);
		НомерСтроки = НомерСтроки + 1;
		
	КонецЦикла;
	
	ОбластьПодвал.Параметры.ИтогСумма = ОбщаяСуммаДокументов;
	ТабДок.Вывести(ОбластьПодвал);
	Возврат ТабДок;
	
КонецФункции

&НаСервере
Функция ПолучитьСписокСтрокой(СписокЗначений)
	
	Результат = "";
	
	Для каждого Элем Из СписокЗначений Цикл
		
		Результат = Результат + Элем.Значение + "  ";
		
	КонецЦикла;
	
	Возврат Результат;
	
КонецФункции

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ТабДок = СформироватьОтчет(Параметры.Период, Параметры.Показатель, Параметры.СписокПодразделений, Параметры.ЗначениеПоказателя);
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	// Вставить содержимое обработчика.
КонецПроцедуры
