
&НаСервере
Процедура ПриЧтенииНаСервере(ТекущийОбъект)
	ДатыЗапретаИзменения.ОбъектПриЧтенииНаСервере(ЭтаФорма, ТекущийОбъект);
КонецПроцедуры

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	
	Если Объект.Склад = Объект.СкладПолучатель Тогда
		
		Отказ = Истина;
		ТекстСообщения = "Выберите разные склады";
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения, Объект.Ссылка, "ДатаПоступления");
	
	КонецЕсли; 
	
	Если Объект.Подразделение <> Объект.ПодразделениеПолучатель 
		 И ЗначениеЗаполнено(Объект.ДатаПоступления) 
		 И НачалоДня(Объект.Дата) > Объект.ДатаПоступления Тогда
		
		Отказ = Истина;
		
		ТекстСообщения = "Дата поступления не может быть меньше даты перемещения";
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения, Объект.Ссылка, "ДатаПоступления"); 
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПодразделениеПолучательПриИзменении(Элемент)
	
	Если Объект.Подразделение = Объект.ПодразделениеПолучатель Тогда
		Элементы.ДатаПоступления.Доступность = Ложь;
	Иначе
		Элементы.ДатаПоступления.Доступность = Истина;
	КонецЕсли; 
		
КонецПроцедуры

&НаКлиенте
Процедура ПодразделениеПриИзменении(Элемент)
	
	Если Объект.Подразделение = Объект.ПодразделениеПолучатель Тогда
		Элементы.ДатаПоступления.Доступность = Ложь;
	Иначе
		Элементы.ДатаПоступления.Доступность = Истина;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)

	Если Объект.Подразделение = Объект.ПодразделениеПолучатель Тогда
		Элементы.ДатаПоступления.Доступность = Ложь;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ЭтаФорма.ТолькоПросмотр = ЛексСервер.ДоступностьФормыСкладскиеДокументы(Объект.Ссылка);
	
КонецПроцедуры

&НаКлиенте
Процедура Подобрать(Команда)
	
	СтандартнаяОбработка = Ложь;
	
	Если НЕ ЗначениеЗаполнено(Объект.Склад) Тогда
		
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Заполните склад отправитель", ,"Объект.Склад");
		
	Иначе
	
		Пар = Новый Структура();
		Пар.Вставить("Комплектация", УпаковатьТаблицу());
		Пар.Вставить("ТолькоБазовая", Ложь);
		Пар.Вставить("Подразделение", Объект.Подразделение);
		Пар.Вставить("Склад", Объект.Склад);
		ОткрытьФорму("Справочник.Номенклатура.Форма.ФормаПодбора", Пар, Элементы.СписокНоменклатуры,,,,,РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
		
	КонецЕсли;
		
КонецПроцедуры

&НаСервере
Функция УпаковатьТаблицу()
	
	ТЗ = Объект.СписокНоменклатуры.Выгрузить();
	АдресТаблицы = ПоместитьВоВременноеХранилище(ТЗ);
	Структура = Новый Структура;
	Структура.Вставить("АдресТаблицы", АдресТаблицы);
	
	Возврат Структура;
	
КонецФункции

&НаКлиенте
Процедура СписокНоменклатурыОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	
	Модифицированность = Истина;
	ЗаполнитьСписокНоменклатуры(ВыбранноеЗначение.АдресТаблицы);
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьСписокНоменклатуры(АдресТаблицы)
	
	Объект.СписокНоменклатуры.Очистить();
	ТЗ = ПолучитьИзВременногоХранилища(АдресТаблицы);
	
	Для Каждого Стр Из ТЗ Цикл
		
		Строка = Объект.СписокНоменклатуры.Добавить();
		ЗаполнитьЗначенияСвойств(Строка, Стр);
		
	КонецЦикла;
	
КонецПроцедуры



