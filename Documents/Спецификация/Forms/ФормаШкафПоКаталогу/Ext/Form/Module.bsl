
&НаКлиенте
Процедура ИзделиеНажатие(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	ТекущийЭлементИзделия = ПредопределенноеЗначение("Перечисление.ВидыИзделийПоКаталогу." + ЭтаФорма.ТекущийЭлемент.Имя);	
	НашаСтрока = Детали.НайтиСтроки(Новый Структура("Элемент", ТекущийЭлементИзделия));
	ЕстьСтрока = НашаСтрока.Количество() = 1;
	
	Если ЕстьСтрока Тогда
		Элементы.Детали.ТекущаяСтрока = Детали.Индекс(НашаСтрока[0]);
		УстановитьОграничения(НашаСтрока[0]);
	Иначе
		Элементы.Детали.ТекущаяСтрока = Неопределено;
	КонецЕсли;
	
	УстановитьДоступность(ЕстьСтрока);
	
КонецПроцедуры

&НаКлиенте
Процедура ВыборИзделия(Команда)
	
	Изделие = ОткрытьФормуМодально("Справочник.КаталогИзделий.ФормаВыбора", , ЭтаФорма);
	
	ЭлементИзделия = ЭтаФорма.ТекущийЭлемент.Имя;
	ТекущийЭлементИзделия = ПредопределенноеЗначение("Перечисление.ВидыИзделийПоКаталогу." + ЭтаФорма.ТекущийЭлемент.Имя);	
	СтруктураИзделия = ПолучитьСтруктуруИзделия(Изделие, РабочийКаталог);
	
	НашаСтрока = Детали.НайтиСтроки(Новый Структура("Элемент", ТекущийЭлементИзделия));
	ЕстьСтрока = НашаСтрока.Количество() = 1;
	
	Если ЕстьСтрока Тогда
		НоваяСтрока = НашаСтрока[0];
	Иначе
		НоваяСтрока = Детали.Добавить();
	КонецЕсли;
	
	НоваяСтрока.Изделие = Изделие;
	НоваяСтрока.ВысотаИзделия = СтруктураИзделия.ВысотаИзделия;
	НоваяСтрока.ШиринаИзделия = СтруктураИзделия.ШиринаИзделия;
	НоваяСтрока.ГлубинаИзделия = СтруктураИзделия.ГлубинаИзделия;
	НоваяСтрока.ВысотаИзделияМин = СтруктураИзделия.ВысотаИзделияМин;
	НоваяСтрока.ШиринаИзделияМин = СтруктураИзделия.ШиринаИзделияМин;
	НоваяСтрока.ГлубинаИзделияМин = СтруктураИзделия.ГлубинаИзделияМин;
	НоваяСтрока.ВысотаИзделияМакс = СтруктураИзделия.ВысотаИзделияМакс;
	НоваяСтрока.ШиринаИзделияМакс = СтруктураИзделия.ШиринаИзделияМакс;
	НоваяСтрока.ГлубинаИзделияМакс = СтруктураИзделия.ГлубинаИзделияМакс;
	НоваяСтрока.Элемент = ТекущийЭлементИзделия;
	
	УстановитьОграничения(НоваяСтрока);
	УстановитьДоступность(Истина);
	ОбновитьРазмеры();
	
	ОтобразитьКартинку(СтруктураИзделия.АдресЭлемента, ЭлементИзделия);	
	
КонецПроцедуры

&НаКлиенте
Процедура УстановитьОграничения(СтрокаИзделия)
	
	Элементы.ГлубинаИзделия.Подсказка = Строка(СтрокаИзделия.ГлубинаИзделияМин) + " - " + Строка(СтрокаИзделия.ГлубинаИзделияМакс);
	Элементы.ГлубинаИзделия.МаксимальноеЗначение = СтрокаИзделия.ГлубинаИзделияМакс;
	Элементы.ГлубинаИзделия.МинимальноеЗначение = СтрокаИзделия.ГлубинаИзделияМин;
	Элементы.ШиринаИзделия.Подсказка = Строка(СтрокаИзделия.ШиринаИзделияМин) + " - " + Строка(СтрокаИзделия.ШиринаИзделияМакс);
	Элементы.ШиринаИзделия.МаксимальноеЗначение = СтрокаИзделия.ШиринаИзделияМакс;
	Элементы.ШиринаИзделия.МинимальноеЗначение = СтрокаИзделия.ШиринаИзделияМин;
	Элементы.ВысотаИзделия.Подсказка = Строка(СтрокаИзделия.ВысотаИзделияМин) + " - " + Строка(СтрокаИзделия.ВысотаИзделияМакс);
	Элементы.ВысотаИзделия.МаксимальноеЗначение = СтрокаИзделия.ВысотаИзделияМакс;
	Элементы.ВысотаИзделия.МинимальноеЗначение = СтрокаИзделия.ВысотаИзделияМин;
	
КонецПроцедуры

&НаКлиенте
Процедура УстановитьДоступность(Флаг)
	
	Элементы.ГлубинаИзделия.Доступность = Флаг;
	Элементы.ВысотаИзделия.Доступность = Флаг;
	Элементы.ШиринаИзделия.Доступность = Флаг;
	Элементы.ДеталиНоменклатурыЛДСП.Доступность = Флаг;
	
КонецПроцедуры

&НаКлиенте
Процедура Очистить(Команда)
	
	ЭлементИзделия = ЭтаФорма.ТекущийЭлемент.Имя;	
	ТекущийЭлементИзделия = ПредопределенноеЗначение("Перечисление.ВидыИзделийПоКаталогу." + ЭлементИзделия);
 	НашаСтрока = Детали.НайтиСтроки(Новый Структура("Элемент", ТекущийЭлементИзделия));
	ЕстьСтрока = НашаСтрока.Количество() = 1;
	
	Если ЕстьСтрока Тогда
		Детали.Удалить(НашаСтрока[0]);
		ЭтаФорма[ЭлементИзделия] = "";
	КонецЕсли;
	
КонецПроцедуры

&НаСервереБезКонтекста
Функция ПолучитьСтруктуруИзделия(Изделие, Каталог)
	
	Структура = Новый Структура;
	Структура.Вставить("АдресЭлемента", Каталог + "Изделие" + Изделие.Код);
	Структура.Вставить("ВысотаИзделия", Изделие.ВысотаИзделия);
	Структура.Вставить("ШиринаИзделия", Изделие.ШиринаИзделия);
	Структура.Вставить("ГлубинаИзделия", Изделие.ГлубинаИзделия);
	Структура.Вставить("ВысотаИзделияМин", Изделие.ВысотаИзделияМин);
	Структура.Вставить("ШиринаИзделияМин", Изделие.ШиринаИзделияМин);
	Структура.Вставить("ГлубинаИзделияМин", Изделие.ГлубинаИзделияМин);
	Структура.Вставить("ВысотаИзделияМакс", Изделие.ВысотаИзделияМакс);
	Структура.Вставить("ШиринаИзделияМакс", Изделие.ШиринаИзделияМакс);
	Структура.Вставить("ГлубинаИзделияМакс", Изделие.ГлубинаИзделияМакс);
	
	Возврат Структура;
	
КонецФункции

&НаКлиенте
Процедура ОтобразитьКартинку(АдресЭлемента, ЭлементИзделия)
		
	АдресВХранилище = "";
	Если ЗначениеЗаполнено(АдресЭлемента) Тогда
		ИмяФайла = АдресЭлемента;
		ФайлИзображения = Новый Файл(ИмяФайла);
		Если ФайлИзображения.Существует() Тогда
			ПоместитьФайл(АдресВХранилище, ИмяФайла, , Ложь, ЭтаФорма.УникальныйИдентификатор);
		КонецЕсли;
	КонецЕсли;
	
	ЭтаФорма[ЭлементИзделия] = АдресВХранилище;
	
КонецПроцедуры	

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	РабочийКаталог = ФайловыеФункцииСлужебныйКлиент.ВыбратьПутьККаталогуДанныхПользователя();
	
КонецПроцедуры

&НаКлиенте
Процедура ГлубинаИзделияПриИзменении(Элемент = Неопределено)
	
	Значение = 0;
	Для Каждого Строка Из Детали Цикл
		Значение = Макс(Значение, Строка.ГлубинаИзделия);
	КонецЦикла;
	
	ГлубинаИтог = Значение;
	
КонецПроцедуры

&НаКлиенте
Процедура ШиринаИзделияПриИзменении(Элемент = Неопределено)
	
	ЗначениеКрыша = 0;
	ЗначениеПол = 0;
	ЗначениеОсновной = 0;
	ЗначениеПравыйБок = 0;
	ЗначениеЛевыйБок = 0;
	
	Для Каждого Строка Из Детали Цикл
		Если Строка.Элемент = ПредопределенноеЗначение("Перечисление.ВидыИзделийПоКаталогу.Крыша") Тогда
			ЗначениеКрыша = Строка.ШиринаИзделия;
		ИначеЕсли Строка.Элемент = ПредопределенноеЗначение("Перечисление.ВидыИзделийПоКаталогу.ЛевыйБоковойЭлемент") Тогда	
			ЗначениеЛевыйБок = Строка.ШиринаИзделия;
		ИначеЕсли Строка.Элемент = ПредопределенноеЗначение("Перечисление.ВидыИзделийПоКаталогу.ОсновнойЭлемент") Тогда	
			ЗначениеОсновной = Строка.ШиринаИзделия;
		ИначеЕсли Строка.Элемент = ПредопределенноеЗначение("Перечисление.ВидыИзделийПоКаталогу.Пол") Тогда
			ЗначениеПол = Строка.ШиринаИзделия; 
		ИначеЕсли Строка.Элемент = ПредопределенноеЗначение("Перечисление.ВидыИзделийПоКаталогу.ПравыйБоковойЭлемент") Тогда
			ЗначениеПравыйБок = Строка.ШиринаИзделия;
		КонецЕсли;	
	КонецЦикла;
	
	ШиринаИтог = Макс(ЗначениеКрыша, ЗначениеЛевыйБок + ЗначениеОсновной + ЗначениеПравыйБок, ЗначениеПол);
	
КонецПроцедуры

&НаКлиенте
Процедура ВысотаИзделияПриИзменении(Элемент = Неопределено)
	
	ЗначениеКрыша = 0;
	ЗначениеПол = 0;
	ЗначениеОсновной = 0;
	ЗначениеПравыйБок = 0;
	ЗначениеЛевыйБок = 0;
	
	Для Каждого Строка Из Детали Цикл
		Если Строка.Элемент = ПредопределенноеЗначение("Перечисление.ВидыИзделийПоКаталогу.Крыша") Тогда
			ЗначениеКрыша = Строка.ВысотаИзделия;
		ИначеЕсли Строка.Элемент = ПредопределенноеЗначение("Перечисление.ВидыИзделийПоКаталогу.ЛевыйБоковойЭлемент") Тогда	
			ЗначениеЛевыйБок = Строка.ВысотаИзделия;
		ИначеЕсли Строка.Элемент = ПредопределенноеЗначение("Перечисление.ВидыИзделийПоКаталогу.ОсновнойЭлемент") Тогда	
			ЗначениеОсновной = Строка.ВысотаИзделия;
		ИначеЕсли Строка.Элемент = ПредопределенноеЗначение("Перечисление.ВидыИзделийПоКаталогу.Пол") Тогда
			ЗначениеПол = Строка.ВысотаИзделия; 
		ИначеЕсли Строка.Элемент = ПредопределенноеЗначение("Перечисление.ВидыИзделийПоКаталогу.ПравыйБоковойЭлемент") Тогда
			ЗначениеПравыйБок = Строка.ВысотаИзделия;
		КонецЕсли;	
	КонецЦикла;
	
	ВысотаИтог = ЗначениеКрыша + Макс(ЗначениеЛевыйБок, ЗначениеОсновной, ЗначениеПравыйБок) + ЗначениеПол;
	
КонецПроцедуры

&НаКлиенте
Процедура ОбновитьРазмеры()
	
	ВысотаИзделияПриИзменении();
	ШиринаИзделияПриИзменении();
	ГлубинаИзделияПриИзменении();
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	
КонецПроцедуры

&НаКлиенте
Процедура ЗадняяСтенкаПриИзменении(Элемент)
	
	Если ЗначениеЗаполнено(ЗадняяСтенка) Тогда
		Стенка = ПредопределенноеЗначение("Перечисление.ВидыИзделийПоКаталогу.ЗадняяСтенка"); 
		НашаСтрока = Детали.НайтиСтроки(Новый Структура("Элемент", Стенка));
		ЕстьСтрока = НашаСтрока.Количество() = 1;
		
		Если ЕстьСтрока Тогда
			НоваяСтрока = НашаСтрока[0];
		Иначе
			НоваяСтрока = Детали.Добавить();
		КонецЕсли;
		
		НоваяСтрока.Изделие = ЗадняяСтенка;
		//НоваяСтрока.ВысотаИзделия = СтруктураИзделия.ВысотаИзделия;
		//НоваяСтрока.ШиринаИзделия = СтруктураИзделия.ШиринаИзделия;
		//НоваяСтрока.ГлубинаИзделия = СтруктураИзделия.ГлубинаИзделия;
		//НоваяСтрока.ВысотаИзделияМин = СтруктураИзделия.ВысотаИзделияМин;
		//НоваяСтрока.ШиринаИзделияМин = СтруктураИзделия.ШиринаИзделияМин;
		//НоваяСтрока.ГлубинаИзделияМин = СтруктураИзделия.ГлубинаИзделияМин;
		//НоваяСтрока.ВысотаИзделияМакс = СтруктураИзделия.ВысотаИзделияМакс;
		//НоваяСтрока.ШиринаИзделияМакс = СтруктураИзделия.ШиринаИзделияМакс;
		//НоваяСтрока.ГлубинаИзделияМакс = СтруктураИзделия.ГлубинаИзделияМакс;
		НоваяСтрока.Элемент = Стенка;
	КонецЕсли;	
КонецПроцедуры

&НаКлиенте
Процедура ЗадняяСтенкаОчистка(Элемент, СтандартнаяОбработка)

 	НашаСтрока = Детали.НайтиСтроки(Новый Структура("Элемент", ПредопределенноеЗначение("Перечисление.ВидыИзделийПоКаталогу.ЗадняяСтенка")));
	ЕстьСтрока = НашаСтрока.Количество() = 1;
	
	Если ЕстьСтрока Тогда
		Детали.Удалить(НашаСтрока[0]);
	КонецЕсли;	
	 	
КонецПроцедуры







