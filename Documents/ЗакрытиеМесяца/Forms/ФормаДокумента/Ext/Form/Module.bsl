&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если НЕ ЗначениеЗаполнено(Объект.Дата) Тогда
	
		Объект.Дата = КонецМесяца(ТекущаяДата());
	
	КонецЕсли; 	
	
	
КонецПроцедуры

&НаКлиенте
Процедура Сформировать(Команда)
	
	ЗаполнитьДанными();
	
КонецПроцедуры
			   
&НаСервере
Процедура ЗаполнитьДанными()
	
	Если ЗначениеЗаполнено(Объект.Подразделение) Тогда
			
		Запрос = Новый Запрос;
		Запрос.УстановитьПараметр("Подразделение", Объект.Подразделение);
		Запрос.УстановитьПараметр("НачалоПериода", НачалоМесяца(Объект.Дата));
		Запрос.УстановитьПараметр("КонецПериода", КонецМесяца(Объект.Дата)-1);
		
		Запрос.Текст = "ВЫБРАТЬ
		               |	УправленческийОстаткиИОбороты.Субконто1 КАК Статья,
					   |	УправленческийОстаткиИОбороты.Субконто1.Наименование КАК Наименование,
		               |	УправленческийОстаткиИОбороты.СуммаКонечныйРазвернутыйОстатокДт КАК Расход,
		               |	УправленческийОстаткиИОбороты.СуммаКонечныйРазвернутыйОстатокКт КАК Доход,
		               |	ВЫБОР
		               |		КОГДА УправленческийОстаткиИОбороты.СуммаКонечныйРазвернутыйОстатокКт > 0
		               |			ТОГДА 0
		               |		ИНАЧЕ 1
		               |	КОНЕЦ КАК Сорт
		               |ИЗ
		               |	РегистрБухгалтерии.Управленческий.ОстаткиИОбороты(&НачалоПериода, &КонецПериода, Месяц, , Счет В ИЕРАРХИИ (ЗНАЧЕНИЕ(ПланСчетов.Управленческий.ПрибыльУбытки)), , Подразделение = &Подразделение) КАК УправленческийОстаткиИОбороты
		               |
		               |УПОРЯДОЧИТЬ ПО
		               |	Сорт,
		               |	Наименование";
		Результат = Запрос.Выполнить();
		Выборка = Результат.Выбрать();
		
		Объект.Список.Загрузить(Результат.Выгрузить());
		
		Объект.Сумма = Объект.Список.Итог("Доход") - Объект.Список.Итог("Расход")
	
	КонецЕсли; 
	
КонецПроцедуры


&НаКлиенте
Процедура ПериодПриИзменении(Элемент)
	
	Объект.Дата = КонецМесяца(Объект.Дата);
	ЗаполнитьДанными();
	
КонецПроцедуры


&НаКлиенте
Процедура ПодразделениеПриИзменении(Элемент)
	
	ЗаполнитьДанными();
	
КонецПроцедуры

&НаСервере
Процедура ПриЧтенииНаСервере(ТекущийОбъект)

	ДатыЗапретаИзменения.ОбъектПриЧтенииНаСервере(ЭтаФорма, ТекущийОбъект);
	
КонецПроцедуры
 
 