////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ОБЩЕГО НАЗНАЧЕНИЯ

&НаСервере
Процедура ЗаполнитьУдержания()
	
	Объект.Удержания.Очистить();
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Монтаж", Объект.Монтаж);
	Запрос.Текст =
	"ВЫБРАТЬ
	|	Монтаж.Экспедитор,
	|	Монтаж.Грузчик1,
	|	Монтаж.Грузчик2,
	|	Монтаж.Спецификация.Автор.ФизическоеЛицо КАК Дизайнер
	|ИЗ
	|	Документ.Монтаж КАК Монтаж
	|ГДЕ
	|	Монтаж.Ссылка = &Монтаж";
	
	Результат = Запрос.Выполнить();
	Если Результат.Пустой() Тогда
		Возврат;
	КонецЕсли;
	
	Выборка = Результат.Выбрать();
	Выборка.Следующий();
	
	ПустойСотрудник = Справочники.ФизическиеЛица.ПустаяСсылка();
	
	// dmn 2012_01_12
	// по дурацки выглядит как-то
	// хорошо бы переделать когда скучно будет :)
	
	Если Выборка.Экспедитор <> ПустойСотрудник Тогда
		НоваяСтрока = Объект.Удержания .Добавить();
		НоваяСтрока.Сотрудник = Выборка.Экспедитор;
		НоваяСтрока.Роль = "Экспедитор";
	КонецЕсли;
	
	Если Выборка.Дизайнер <> ПустойСотрудник Тогда
		НоваяСтрока = Объект.Удержания .Добавить();
		НоваяСтрока.Сотрудник = Выборка.Дизайнер;
		НоваяСтрока.Роль = "Дизайнер";
	КонецЕсли;
	
	Если Выборка.Грузчик1 <> ПустойСотрудник Тогда
		НоваяСтрока = Объект.Удержания .Добавить();
		НоваяСтрока.Сотрудник = Выборка.Грузчик1;
		НоваяСтрока.Роль = "Грузчик1";
	КонецЕсли;
	
	Если Выборка.Грузчик2 <> ПустойСотрудник Тогда
		НоваяСтрока = Объект.Удержания .Добавить();
		НоваяСтрока.Сотрудник = Выборка.Грузчик2;
		НоваяСтрока.Роль = "Грузчик2";
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ГрафикМонтажаПриИзменении(Элемент)
	
	ЗаполнитьУдержания();
	
КонецПроцедуры

&НаСервере
Процедура ПослеЗаписиНаСервере(ТекущийОбъект, ПараметрыЗаписи)
	
	УстановитьПараметрЗапроса();
	
КонецПроцедуры

&НаСервере
Процедура УстановитьПараметрЗапроса()
	
	//СписокРасчетИнженера.Параметры.УстановитьЗначениеПараметра("Ссылка", Объект.Ссылка);
	
КонецПроцедуры

&НаКлиенте
Процедура ПеречитатьСотрудников(Команда)
	
	ЗаполнитьУдержания();
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ДЛЯ УПРАВЛЕНИЯ ВНЕШНИМ ВИДОМ ФОРМЫ

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

&НаСервере
Процедура ПриЧтенииНаСервере(ТекущийОбъект)

	ПодпискиНаСобытия.ОбъектПриЧтенииНаСервере(ЭтаФорма, ТекущийОбъект);
	
КонецПроцедуры

&НаКлиенте
Процедура ПослеЗаписи(ПараметрыЗаписи)
	
	// Если открыли данную форму из формы документа, то там надо поменять текст
	Если НЕ ВладелецФормы = Неопределено Тогда
		
		Если ТипЗнч(ВладелецФормы) = Тип("УправляемаяФорма") тогда
			
			ЗакрыватьПриВыборе = Ложь;
			
			Если Найти(ВладелецФормы.ИмяФормы, "ФормаДокумента") <> 0 И ВладелецФормы.Объект.Ссылка = Объект.ГрафикМонтажа Тогда
				ОповеститьОВыборе(Строка(Объект.Ссылка));
			Иначе
				ОповеститьОВыборе("Ввести Переделки");
			КонецЕсли;
			
		КонецЕсли;
	КонецЕсли;

КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если НЕ ЗначениеЗаполнено(Объект.Ссылка) Тогда
		ЗаполнитьУдержания();
	КонецЕсли;
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ДЕЙСТВИЯ КОМАНДНЫХ ПАНЕЛЕЙ ФОРМЫ

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ ОБРАБОТКИ СВОЙСТВ И КАТЕГОРИЙ

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ РЕКВИЗИТОВ ШАПКИ

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ РЕКВИЗИТОВ ТАБЛИЧНОГО ПОЛЯ <Наименование>

////////////////////////////////////////////////////////////////////////////////
// ОПЕРАТОРЫ ОСНОВНОЙ ПРОГРАММЫ

